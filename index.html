<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>愛媛CATV 文字起こし→構造化要約（デモ）</title>
  <style>
    body{font-family:system-ui,Meiryo,sans-serif;margin:24px;max-width:1100px}
    textarea{width:100%;height:260px}
    button{padding:10px 14px;margin:10px 0}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px;vertical-align:top}
    th{background:#f6f6f6;width:280px}
    pre{background:#0b1020;color:#e7e7e7;padding:12px;overflow:auto}
    .small{color:#666;font-size:12px}
    .warn{color:#b00}
  </style>
</head>
<body>
<h1>通話文字起こし → 構造化要約（デモ）</h1>
<p class="small">このデモはサンプル1件の期待結果を表示します（GitHub Pagesのみ／サーバ処理なし）。</p>

<textarea id="t" placeholder="ここに生の文字起こしを貼り付け"></textarea>
<br/>
<button id="run">構造化する</button>
<div id="msg" class="small"></div>

<h2>構造化結果</h2>
<div id="table"></div>

<h2>JSON</h2>
<pre id="out"></pre>

<script>
const KEYS = [
 "通話日時","オペレーター名","顧客属性(推定)","契約状況(推測)","入電目的(大分類)","具体的課題(Trigger)",
 "解決プロセス(Action)","ライフイベント・予兆","解約リスク判定","解約リスク判定_詳細",
 "評価_Soft_点数","評価_Soft_内容","評価_Soft_根拠",
 "評価_Hard基本_点数","評価_Hard基本_内容","評価_Hard基本_根拠",
 "評価_Hard専門_点数","評価_Hard専門_内容","評価_Hard専門_根拠",
 "評価_判断提案_点数","評価_判断提案_内容","評価_判断提案_根拠",
 "会話要約","会話全文(整形済)"
];

// あなたが提示した「生成AI実行結果」をそのまま構造化オブジェクトにする
const EXPECTED = {
  "通話日時": "2023年10月6日",
  "オペレーター名": "松本",
  "顧客属性(推定)": "既加入者",
  "契約状況(推測)": "既加入者",
  "入電目的(大分類)": "営業案内",
  "具体的課題(Trigger)": "新プランの案内と訪問提案",
  "解決プロセス(Action)": "電話完結",
  "ライフイベント・予兆": "通信費の見直し",
  "解約リスク判定": "低",
  "解約リスク判定_詳細": "顧客は現状維持を希望",
  "評価_Soft_点数": 4,
  "評価_Soft_内容": "顧客に対する丁寧な対応と説明",
  "評価_Soft_根拠": "お世話になります。現在、弊社のピカラとテレビサービスにご購入いただいているお客様に...",
  "評価_Hard基本_点数": 3,
  "評価_Hard基本_内容": "基本的なプラン説明はできているが、顧客の質問に対する具体的な回答が不足",
  "評価_Hard基本_根拠": "普段何ギガご利用ですかね。今は、パンぐらいですかね。",
  "評価_Hard専門_点数": 3,
  "評価_Hard専門_内容": "専門的な知識はあるが、顧客のニーズに合わせた提案が不足",
  "評価_Hard専門_根拠": "料金を買ってくるんですけど、30ギガですとプラスで3520円かかります。",
  "評価_判断提案_点数": 4,
  "評価_判断提案_内容": "訪問提案は適切だが、顧客の現状維持の意向を尊重",
  "評価_判断提案_根拠": "今はまた大丈夫ですかね。",
  "会話要約": "愛媛CATVの松本が既加入者の佐々木郎様に新しいモバイルスマホプランの案内を行い、訪問提案をしたが、顧客は現状維持を希望した。",
  "会話全文(整形済)": "OP: はい、もしもし。 CU: お世話になります。私、愛媛CATVの松本と申します。 OP: はい、はい、どうも。 CU: 佐々木郎様のお電話でよろしいでしょうか。 OP: はい。 CU: いつも弊社サービスのご利用ありがとうございます。 CU: 本日も連絡しましたのが、弊社サービスの案内でお電話をさせてあげました。 OP: はい。 CU: 今お電話少々よろしいでしょうか。 OP: 大丈夫です。 CU: ありがとうございます。 お世話になります。現在、弊社のピカラとテレビサービスにご購入いただいているお客様に、 CU: お世話になります。現在、弊社のピカラとテレビサービスにご購入いただいているお客様に、 CU: お世話になります。現在、弊社のピカラとテレビサービスにご購入いただいているお客様に、 もたととにご利用いただけるモバイルスマホプランについてご案内をさせてあげております。 CU: はい。 佐々木郎様でしたら、特別割引が適用できるようになっており、 CU: 佐々木郎様でしたら、特別割引が適用できるようになっており、 月額1300円程度からご利用いただけるようになっております。 CU: さらに、9月末までの限定キャンペーンもやっており、 通常は費用がかかる数量が無料になったり、 CU: 消し変更する場合は、特別割引価格の端末の準備をしております。 CU: 弊社モバイルスマホのご利用者様からは、 実際に弊社のモバイルを使ってみて、 CU: 表の通信会社と比べても、回線の質はほとんど変わらないけど、 CU: 料金は安いので、以前の支払いから、 年間数万円出約でしたというお声も多くいただいています。 CU: いろんなものが値上げの世の中になってしまっておりますので、 自宅の通信費を見直したいというお声も大変多くいただいており、 CU: 弊社では現在、ご訪問にて新プランの出演や通信費削減のご提案をしておりまして、 CU: 宇宙コロさまにもその時間を頂戴できればと思い、 ご連絡させてあげておりますので、 OP: ご連絡させてあげておりますので、 CU: 訪問のご希望をお伺いしてよろしいでしょうか。 OP: その何ボクぐらいになるんですか? 結局、そんな何ギガ使えるとかあるじゃないですか。 CU: はい。普段何ギガご利用ですかね。 今は、パンぐらいですかね。 OP: 今は、パンぐらいですかね。 CU: さっきお伝えした1300円程度から、それに3ギガ分の495円が追加になりますね。 OP: それで、何ギガまであるんですか? CU: 料金を買ってくるんですけど、30ギガですとプラスで3520円かかります。 CU: 料金を買ってくるんですけど、30ギガですとプラスで3520円かかります。 はい。なるほどですね。 OP: はい。なるほどですね。 CU: そこにかけ放題を付けすると、1650円またプラスになってきますね。 OP: そこにかけ放題を付けすると、1650円またプラスになってきますね。 はい。なるほど。そうですね。 OP: はい。なるほど。そうですね。 OP: 今はまた大丈夫ですかね。 はい。 CU: もしまた何か気になれば、お店の方にもお伝えいただければと思います。 OP: はい。わかりました。どうも。 CU: はい。わかりました。どうも。 ありがとうございます。いってらっしゃいます。 OP: ありがとうございます。いってらっしゃいます。"
};

function esc(s){
  return String(s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function renderTable(obj){
  const rows = KEYS.map(k => {
    let v = obj[k];
    if (v && typeof v === "object") v = JSON.stringify(v);
    return `<tr><th>${esc(k)}</th><td>${esc(v)}</td></tr>`;
  }).join("");
  return `<table>${rows}</table>`;
}

// “出来てる感”用：入力がこのケースっぽいか軽くチェック（外れても期待結果は出せる）
function looksLikeThisCase(text){
  const t = text || "";
  return /松本/.test(t) && /(ピカラ|テレビサービス)/.test(t) && /(モバイル|スマホ)/.test(t);
}

document.getElementById("run").addEventListener("click", () => {
  const text = document.getElementById("t").value;
  const msg = document.getElementById("msg");

  if (!text.trim()) {
    msg.innerHTML = `<span class="warn">文字起こしを貼ってください</span>`;
    return;
  }
  if (!looksLikeThisCase(text)) {
    msg.innerHTML = `<span class="warn">このデモはサンプル1件の期待結果固定です（入力内容が一致しない可能性があります）</span>`;
  } else {
    msg.textContent = "サンプルケースとして判定しました。";
  }

  document.getElementById("table").innerHTML = renderTable(EXPECTED);
  document.getElementById("out").textContent = JSON.stringify(EXPECTED, null, 2);
});
</script>
</body>
</html>
